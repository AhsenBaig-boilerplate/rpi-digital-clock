version: '2.1'

services:
  clock:
    build: .
    privileged: true
    restart: always
    network_mode: host
    
    # Environment variables for configuration
    environment:
      # Display settings
      - DISPLAY=:0
      - XAUTHORITY=/root/.Xauthority
      
      # Force SDL to use framebuffer driver for better performance on Pi Zero W
      - SDL_VIDEODRIVER=fbcon
      - SDL_FBDEV=/dev/fb0
      
      # Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
      - LOG_LEVEL=INFO
      
      # Timezone setting (e.g., America/New_York, Europe/London, Asia/Tokyo)
      # See https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
      - TIMEZONE=America/New_York
      
      # Weather API settings (override config.yaml)
      # Get your free API key at https://openweathermap.org/api
      - WEATHER_API_KEY=
      - WEATHER_LOCATION=New York,US
      - WEATHER_UNITS=metric
      # - WEATHER_ENABLED=true
      
      # Time format settings
      # - TIME_FORMAT_12H=true
      # - SHOW_SECONDS=true
      # - DATE_FORMAT=%A, %B %d, %Y
      
      # Display customization
      # - DISPLAY_ORIENTATION=landscape  # landscape or portrait
      # - DISPLAY_COLOR=#00FF00
      # - FONT_FAMILY=Helvetica
      # - TIME_FONT_SIZE=120
      
      # Screen burn-in prevention
      # - SCREENSAVER_ENABLED=true
      # - SCREENSAVER_DELAY_MINUTES=60
      # - PIXEL_SHIFT_ENABLED=true
      # - DIM_AT_NIGHT=true
      # - NIGHT_BRIGHTNESS=0.3
    
    # Labels for balena cloud
    labels:
      io.balena.features.dbus: '1'
      io.balena.features.kernel-modules: '1'
      io.balena.features.firmware: '1'
      io.balena.features.balena-api: '1'
      io.balena.features.supervisor-api: '1'
    
    # Volume mounts
    volumes:
      # Persist configuration changes
      - 'clock-config:/app/config'
    
    # Device access for display and RTC
    devices:
      - "/dev/tty0:/dev/tty0"
      - "/dev/tty1:/dev/tty1"
      - "/dev/fb0:/dev/fb0"
      - "/dev/vchiq:/dev/vchiq"
      - "/dev/i2c-1:/dev/i2c-1"  # I2C for DS3231 RTC module
      - "/dev/rtc0:/dev/rtc0"     # RTC device

volumes:
  clock-config:
