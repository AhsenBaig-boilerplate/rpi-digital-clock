version: '2.1'

services:
  clock:
    build: .
    privileged: true
    restart: always
    network_mode: host
    
    # Environment variables for configuration
    environment:
      # Display settings
      - DISPLAY=:0
      - XAUTHORITY=/root/.Xauthority
      
      # Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
      - LOG_LEVEL=INFO
      
      # Weather API settings (override config.yaml)
      # Get your free API key at https://openweathermap.org/api
      - WEATHER_API_KEY=
      - WEATHER_LOCATION=New York,US
    
    # Labels for balena cloud
    labels:
      io.balena.features.dbus: '1'
      io.balena.features.kernel-modules: '1'
      io.balena.features.firmware: '1'
      io.balena.features.balena-api: '1'
      io.balena.features.supervisor-api: '1'
    
    # Volume mounts
    volumes:
      # Persist configuration changes
      - 'clock-config:/app/config'
      # X11 socket
      - '/tmp/.X11-unix:/tmp/.X11-unix'
    
    # Device access for display and RTC
    devices:
      - "/dev/tty0:/dev/tty0"
      - "/dev/tty1:/dev/tty1"
      - "/dev/fb0:/dev/fb0"
      - "/dev/vchiq:/dev/vchiq"
      - "/dev/i2c-1:/dev/i2c-1"  # I2C for DS3231 RTC module
      - "/dev/rtc0:/dev/rtc0"     # RTC device

volumes:
  clock-config:
